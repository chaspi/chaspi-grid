<link rel="import" href="../../ldwebapp/bower_components/polymer/polymer.html">
<link rel="import" href="grid-header.html">
<link rel="import" href="grid-row.html">
<link rel="import" href="grid-cell.html">
<dom-module id="qnamic-grid">
	<template>
		<style is="custom-style">
			:host {
				display: table;
			}
			.tbody {
				display: table-row-group;
			}
			grid-row {
				@apply(--qnamic-grid-row);
			}
			grid-cell {
				@apply(--qnamic-grid-cell);
			}
		</style>
			
		<content select="grid-header"></content>
		
		<div class="tbody">
			<template is="dom-repeat" items="{{items}}">
				<grid-row>
					<template is="dom-repeat" as="column" items={{columns}}>
						<grid-cell on-tap="handleTap" style$="{{getStyle(index, item)}}" class$="{{getClass(index, item)}}" content$="[[getContent(index, item)]]"></grid-cell>
					</template>
				</grid-row>
			</template>
		</div>
		
	</template>
	<script>
		Polymer({
			is : 'qnamic-grid',
			properties : {
				trainNote : {
					type : String,
					notify : true,
					observer : '_trainNoteChanged'
				}
			},
			handleTap: function(e) {
		        var item = e.model.item
				var index = e.model.index;
		        var tapListener = this.columns[index]['tapListener']
		        if (tapListener) {
		        	tapListener(e.target, item)
		        }
			},
			getContent : function(index, item) {
				var renderer = this.columns[index]['renderer']
				if (renderer) {
					return renderer(item)['text']
				}
				var contentProvider = this.columns[index]['contentProvider']
				if (contentProvider) {
					return contentProvider(item)
				}
				return item[this.columns[index]['property']]
			},
			getClass : function(index, item) {
				var classProvider = this.columns[index]['classProvider']
				if (classProvider) {
					return classProvider(item)
				}
				var clazz = this.columns[index]['class']
				if (clazz) {
					return clazz
				}
			},
			getStyle : function(index, item) {
				var baseStyle = ''
				var minWidth = this.columns[index]['minWidth']
				if (minWidth) {
					baseStyle += 'min-width:' + minWidth + 'px;'
				}
				var width = this.columns[index]['width']
				if (width) {
					baseStyle += 'width:' + width + 'px;'
				}
				var renderer = this.columns[index]['renderer']
				if (renderer) {
					return baseStyle + renderer(item)['style']
				}
				var styleProvider = this.columns[index]['styleProvider']
				if (styleProvider) {
					return baseStyle + styleProvider(item)
				}
				var style = this.columns[index]['style']
				if (style) {
					return baseStyle + style
				}
				return baseStyle;
			},
			ready : function() {
				
			}
		});
	</script>
</dom-module>