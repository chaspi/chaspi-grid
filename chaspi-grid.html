<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="chaspi-colgroup.html">
<link rel="import" href="chaspi-header.html">
<link rel="import" href="chaspi-footer.html">
<link rel="import" href="chaspi-row.html">

<dom-module id="chaspi-grid">
	<template>
		<style is="custom-style">
			:host {
				display: table;
			}
			
			.tbody {
				display: table-row-group;
			}
		</style>

		<content id="colgroups" select="chaspi-colgroup"></content>
		<content select="chaspi-header"></content>

		<div class="tbody">
			<template is="dom-repeat" items="{{items}}">
				<chaspi-row>
					<template is="dom-repeat" as="column" items={{getCols()}}>
						<template is="dom-if" if="{{column.renderHtml}}">
							<chaspi-cell on-tap="handleTap" style$="{{getStyle(column, item)}}" class$="{{getClass(column, item)}}" content$="[[getContent(column, item)]]"></chaspi-cell>
						</template>
						<template is="dom-if" if="{{!column.renderHtml}}">
							<chaspi-cell on-tap="handleTap" style$="{{getStyle(column, item)}}" class$="{{getClass(column, item)}}">[[getContent(column, item)]]</chaspi-cell>
						</template>
					</template>
				</chaspi-row>
			</template>
		</div>

		<content select="chaspi-footer"></content>

	</template>
	<script>
		Polymer({
			is : 'chaspi-grid',
			properties : {
				items : Object
			},
			handleTap: function(e) {
		    	e.model.column.tapListener(e.target, e.model.item)
			},
			getContent : function(column, item) {
				return column.getContents(item)
			},
			getClass : function(column, item) {
				return column.getClass(item)
			},
			getStyle : function(column, item) {
				return column.getStyle(item)
			},
			getCols : function() {
				var distributed = this.getContentChildren('#colgroups');
				if (distributed.length < 1) {
					throw "No columns defined!";
				}
				var cols = []
				distributed.forEach(function(entry) {
					cols.push.apply(cols, entry.queryAllEffectiveChildren('chaspi-col'));
				});
				return cols
			}
		});
	</script>
</dom-module>