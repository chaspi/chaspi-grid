<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="chaspi-header.html">
<link rel="import" href="chaspi-row.html">
<link rel="import" href="chaspi-cell.html">
<dom-module id="chaspi-grid">
	<template>
		<style is="custom-style">
			:host {
				display: table;
			}
			
			.tbody {
				display: table-row-group;
			}			
		</style>

		<content select="chaspi-header"></content>

		<div class="tbody">
			<template is="dom-repeat" items="{{items}}">
				<chaspi-row>
					<template is="dom-repeat" as="column" items={{columns}}>
						<chaspi-cell on-tap="handleTap" style$="{{getStyle(column, item)}}" class$="{{getClass(column, item)}}" content$="[[getContent(column, item)]]"></chaspi-cell>
					</template>
				</chaspi-row>
			</template>
		</div>

	</template>
	<script>
		Polymer({
			is : 'chaspi-grid',
			properties : {
				items : Object,
				columns : Object
			},
			handleTap: function(e) {
		        var tapListener = e.model.column.tapListener
		        if (tapListener) {
		        	tapListener(e.target, e.model.item)
		        }
			},
			getContent : function(column, item) {
				var renderer = column.renderer
				if (renderer) {
					return renderer(item).text
				}
				var contentProvider = column.contentProvider
				if (contentProvider) {
					return contentProvider(item)
				}
				return item[column.property]
			},
			getClass : function(column, item) {
				var renderer = column.renderer
				if (renderer) {
					return renderer(item)['class']
				}
				var classProvider = column.classProvider
				if (classProvider) {
					return classProvider(item)
				}
				var clazz = column['class']
				if (clazz) {
					return clazz
				}
			},
			getStyle : function(column, item) {
				var baseStyle = ''
				var minWidth = column.minWidth
				if (minWidth) {
					baseStyle += 'min-width:' + minWidth + 'px;'
				}
				var width = column.width
				if (width) {
					baseStyle += 'width:' + width + 'px;'
				}
				var renderer = column.renderer
				if (renderer) {
					return baseStyle + renderer(item).style
				}
				var styleProvider = column.styleProvider
				if (styleProvider) {
					return baseStyle + styleProvider(item)
				}
				var style = column.style
				if (style) {
					return baseStyle + style
				}
				return baseStyle;
			},
			ready : function() {
				
			}
		});
	</script>
</dom-module>